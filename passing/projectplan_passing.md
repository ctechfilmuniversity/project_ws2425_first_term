# Whodunit

A 1st term project

## Motivation

I'm interested in different technologies and using them in playful ways. I've been intrigued by logic programming as a concept and programming paradigm since I first heard about it but never had the time to really dig into it. At the same time I was occasionally thinking about what kind of game I could make within the constrains and possibilities offered by a logic programming language such as Prolog.

When remakes of classic "Whodunit"-genre films *Murder on the Orient Express*, *Death on the Nile* (based on the [Agatha Christie](https://en.wikipedia.org/wiki/Agatha_Christie) novels) and, more originally, *Knives Out* hit theaters a few years back, I realized it's the perfect setup for a logic programming game.

"[Whodunit](https://en.wikipedia.org/wiki/Whodunit)" is a simple concept: a crime, likely murder, takes place. All potential suspects are known and, usually,  confined within a physical space. The investigator of the crime is an outside, neutral person, who has to single out the culprit from the suspects using nothing but logic to put together the clues, alibis and motives. The audience knows and learns the clues with the investigator and, in an ideal scenario, is able to deduct who the culprit is through their own thinking, thus creating an entertaining and interesting challenge to akin to participating.

Of course the idea isn't new. The board game [*Cluedo*](https://en.wikipedia.org/wiki/Cluedo) successfully makes use of exactly that setup. The free online game [*Murdle*](https://murdle.com/) builds up on that. I want to try implementing my own version using Prolog.


## Project Details

### Description

*Whodunit* is a text-adventure-style murder-mystery game that is played on the commandline.

The player acts in the role of an investigator for the presented crime scenario through text. They can choose different options to approach the investigation, such as questioning suspects, inspecting locations and so forth.
Different options will yield clues. The clues allow the player to deduce who of the suspects is the culprit.

Upon starting a new game, a scenario is generated in the background. A scenario consists of a crime, several suspects, their motives, possible weapons and locations. The relationship between these elements is procedurally generated and put down in a fact database. The fact-database is a valid Prolog program.

The player however cannot access all facts at once. They have to reveal the facts one after the other through the game. Each interaction is represented as a Prolog query against the fact database and evaluated and kept track of.
When the player able to deduct the culprit and verify the culprit-fact then the case is considered solved and the game ends.

### Categorization

- **Software development**: The project is first and foremost a software project, the outcome is a commandline tool
- **Algorithms**: I plan for the fact-database-generation-component to be procedural. For this I need to find/ come up with a suitable algorithm
- **Research/ Experimentation**: I know very little about logic programming, so this project involves learning Prolog and using it in a sensible way.

### System diagram / Technical setup / Tech stack

There are several components to make Whodunit work:

- Prolog interpreter, most likely [Scryer Prolog](https://www.scryer.pl/)
- Rust-based command-line app that
	- talks to the Prolog interpreter
	- can fill in and host a database of possible scenario elements
	- generates the fact database for a specific scenario from scenario elements as valid Prolog program
	- does general game logic and interfaces
		- [Clap](https://github.com/clap-rs/clap) (command line argument parser) for the cli
		- [Ratatui](https://ratatui.rs/) (terminal UI framework) for the (t)ui
		- [bevy](https://bevyengine.org/) (Entity-Component game engine) for game logic
	- general glue code

### Unique selling point
I want to challenge myself with learning and using a new programming language, paradigm and tech stack. The technologies I want to use here are also fairly niche and it's unlikely that I will come across this same configuration ever again.

## Expected Results

### Baseline solution
The baseline solution should guarantee interoperability between the Rust application/ game code and the Prolog interpreter.
A limited, Cluedo-like, setup should be generated by the game code and fed into the interpreter. The player interacts with the interpreter through raw Prolog queries. Some game state is kept by the game code. (Work packages 1-2)

### Best possible solution
Building up on the baseline solution, there should be a nicer user interface that guides the player through the game experience and abstracts over the Prolog queries. Game state is expanded to allow for more modes and variety during the game.
The procedural generation algorithm should be able to create more divers scenarios than the base Cluedo ones. (Work packages 3-4)

## Vision and Future Work
A first step beyond the 1st term requirements would be polishing the game to the point where I can release it online and people can play it and it works for them. I will also open source all components for people to look at and (hopefully) learn from it.

If it's usable enough I will also apply to some Rust conferences with the project.

## Challenge of your comfort zone
Logic programming and Prolog are new to me. I've started reading [Learn Prolog Now!](https://www.let.rug.nl/bos/lpn/index.php) and will probably follow up with [Facets of Prolog](https://www.metalevel.at/prolog/facets). I've also never used the Ratatui framework or attempted to make a compelling command-line application in Rust and I hope I can make it work.

I think the most difficult part for me is not cutting corners and trying to achieve the goals I initially set. I'm trying to be more of a perfectionist and not always go with the good-enough approach.

## Work plan

### Timeline until the deadline

until 30.01.25:
	- Read Learn Prolog now!
	- Investigate Prolog grammars for fact database structure
until 07.0.2.25:
	- Setup repository and start on work package 1
	- Start project documentation website
until 28.02.25:
	- Work on work packages 1 and 2
	- Hitting Milestone 1 by Feb 28th
from 01.03.25 to 15.03.25:
	- if milestone 1 was hit
		- Work on work package 3, maybe even 4
		- Hitting Milestone 2 by March 8th
		- Hitting Milestong 3 by March 14th
    - if Milestone 1 was not hit:
		- further work on Milestone 1
15.03.25: Deadline

### Work packages

0. Learn Prolog
1. Rust and Prolog interop (the core functionality of talking to the interpreter from my application code)
	- Interacting with Scryer Prolog through Rust code
	- Loading static fact database into Scryer
	- Generating fact database in Rust
	- Loading generated fact database into Scryer
2. Game Logic (building the actual game on top of the interop)
	- Setting up game state and simple interactions with bevy
	- Sending/ verifying Prolog user queries against fact database
	- Interpret Prolog query results into game state
3. Advanced Game Logic and Interaction
	- Define text-based interactions intro Prolog queries
	- Expand game and logic to multiple options
	- Setting up interfaces with Ratatui
4. Polishing
	- Integrate Clap to make the CLI nice
	- Explore more advanced Ratatui interfaces
	- Expand options for fact database

### Milestones
1. Working baseline
	- includes work packages 1 and 2
2. Nice result
	- includes work package 3
3. Best result
	- includes work package 4
